<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">


  <!-- CSS: implied media="all" -->
  <link rel="stylesheet" href="css/style.css?v=2">

  <!-- Uncomment if you are specifically targeting less enabled mobile browsers
  <link rel="stylesheet" media="handheld" href="css/handheld.css?v=2">  -->

  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-1.7.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
    	<link rel="stylesheet" type="text/css" href="../yui/build/fonts/fonts-min.css" />
		<link rel="stylesheet" type="text/css" href="../yui/build/button/assets/skins/sam/button.css" />
		<script type="text/javascript" src="../yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
		<script type="text/javascript" src="../yui/build/element/element-beta-min.js"></script>

		<script type="text/javascript" src="../yui/build/button/button-min.js"></script>
		
		<!-- Prototype Specific Scripts -->
		<script type="text/javascript" src="scripts/organic/metabolism.js"></script>
		<script type="text/javascript" src="scripts/organic/MetabolicRate.js"></script>
		<script type="text/javascript" src="scripts/lib.js"></script>
		<script type="text/javascript" src="scripts/display/display.js"></script>
        <!--begin custom header content for this example-->
    	<style type="text/css">

		    #button-example-form fieldset,
		    #button-example-form fieldset div {

		        border: 2px groove #ccc;
		        margin: .5em;
		        padding: .5em;

		    }

		    .yui-button#pushbutton3 button {

		        padding-left: 2em;
		        background: url(../yui/examples/button/assets/add.gif) 10% 50% no-repeat;

		    }
		    
		    input.numeric.medium {
		    	width:50px;
		    }
		    
		    input.numeric.long {
					width:100px;
		    }

		</style>
		
		

</head>

<body>

  <div id="container">
    <header>

    </header>
    <div id="main" role="main">
   
           <h1>Metabolic Rate</h1>

		<div class="exampleIntro">
			<p>This example demonstrates how to calculate metabolic rate.</p>
		</div>
        
        <div id="chart_div"></div>

		<form id="button-example-form" name="button-example-form" method="post" action="#">

		    <fieldset id="pushbuttons">
		        <legend>Push Buttons</legend>

		            <div>
		                <input type="button" id="pushbutton" name="button" value="Calculate">
		            </div>
		            
		        <fieldset id="calories">
		            <legend>Calories</legend>


		            <div>
									Calories In <input class="numeric medium" type="text" id="calories-in" name="calories-in" value="2500" />    
									Calories Out <input class="numeric medium" type="text" id="calories-out" name="calories-out" value="0" />
		            </div>
	
		            
		            <div>
										Calorie Difference <input class="numeric medium" type="text" id="calorie-difference" name="calorie-difference" value="0" />
										(Kgs) <input class="numeric medium" type="text" id="calorie-difference-kgs" name="calorie-difference-kgs" value="0" />
										(Stone) <input class="numeric medium" type="text" id="calorie-difference-stone" name="calorie-difference-stone" value="0" />
		            </div>

		        </fieldset>
		        <fieldset id="caloriesOverTime">
							<legend>Calories Over Time</legend>
							<div>
									Days <input class="numeric medium" type="text" id="days" name="days" value="365" />
							</div> 
							<div>
								Calories In <input class="numeric long" type="text" id="days-calories-in" name="days-calories-in" value="0" />    
								Calories Out <input class="numeric long" type="text" id="days-calories-out" name="days-calories-out" value="0" />
							</div>


							<div>
									Calorie Difference <input class="numeric long" type="text" id="days-calorie-difference" name="days-calorie-difference" value="0" />
									(Kgs) <input class="numeric medium" type="text" id="days-calorie-difference-kgs" name="days-calorie-difference-kgs" value="0" />
									(Stone) <input class="numeric medium" type="text" id="days-calorie-difference-stone" name="days-calorie-difference-stone" value="0" />
							</div>
           
						
		        </fieldset>

		        <fieldset id="metabolicRate">

		            <legend>Metabolic Rate</legend>
		            <div>
						Weight (kg)<input class="numeric medium" type="text" id="weight" name="weight" value="70" />
						Weight (stone)<input class="numeric medium" type="text" id="weight-stone" name="weight-stone" value="" />
		            </div>
		            <div>
						Body Fat Percentage <input class="numeric medium" type="text" id="percent-fat" name="percent-fat" value="25" />
						Lean Body Mass <input class="numeric medium" type="text" id="lbm" name="lbm" value="0" />
		            </div>
		            <div>
									Basal Metabolic Rate <input class="numeric medium" type="text" id="bmr" name="bmr" value="0" />
									Thermic Effect of Food<input class="numeric medium" type="text" id="tef" name="tef" value="0" />
		            </div>
		            <div>
									Exercise Duration (mins) <input class="numeric medium" type="text" id="exercise-duration" name="exercise-duration" value="30" />
									Exercise intensity (1-3) <input class="numeric medium" type="text" id="exercise-intensity" name="exercise-intensity" value="2" />
									Calories from Exercise <input class="numeric medium" type="text" id="exercise-calories" name="exercise-calories" value="0" />
		            </div>		            
		        </fieldset>

		    </fieldset>

		</form>

		<h2>References</h2>
		<p>
			<ul>
				<li><a href="http://en.wikipedia.org/wiki/Basal_metabolic_rate" target="_blank">McArdle and Katch Metabolic Equation</a></li>
				<li><a href="http://www.caloriesperhour.com/tutorial_thermic.php" target="_blank">Thermic Effect of food</li>
				<li><a href="http://www.brianmac.co.uk/energyexp.htm" target="_blank">Energy Expenditure of Exercise</li>
			</ul>
		</p>
    </div>
    <footer>

    </footer>
  </div> <!--! end of #container -->


  <!-- JavaScript at the bottom for fast page loading -->
  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>

  <!-- scripts for chart -->
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript" src="scripts/display/display.js"></script>
  <script type="text/javascript" src="scripts/lib.js"></script>
  <script type="text/javascript" src="js/chart.js"></script>
  <script type="text/javascript" src="js/form.js"></script>
  <script type="text/javascript" src="js/io.js"></script>
 <!-- End scripts for chart -->

  <!-- scripts concatenated and minified via ant build script-->
  <script src="js/plugins.js"></script>
  <script src="js/script.js"></script>
  <!-- end scripts-->
  
  <!-- start of chart -->
   <script type="text/javascript"> 
  
    var chartTypes = [];
    
    chartTypes[0] = new VisualisationType('columnchart', 'Column chart', 'ColumnChart')

    google.load("visualization", "1", {packages:[chartTypes[0].type]});
    google.setOnLoadCallback(initialiseForm);
    
    var data = null;
    var chart = new Visualisation_Chart();
    var chartOptions = null;
    var visualisationType = 0;
    var chartElementId = 'chart_div';
    var dataSources = [];
    var currentDataSourceId = 0;
    var defaultChartWidth = 800;
    var defaultChartHeight = 240;
    var defaultChartTitle = 'Calorie difference over time from given metabolic rate.';
    var defaultChartIs3D = true;
	
    /*
     * Create default chart and data values
     * @return void
     */
    function initialiseData(){
        
        // calorie difference over time
		chartOptions = chart.createDefaultOptions();
		chartOptions.title = defaultChartTitle;
		dataSource = null;
	   
		data = new google.visualization.DataTable(dataSource);
		data.chartOptions = chartOptions;
        
        data.addColumn('string', 'month');
        data.addColumn('number', 'Cumulative calorie difference (Kcals)');
        data.addColumn('number', 'Cumulative weight difference (Kgs)');
        data.addRows(12);
        for(var x=0;x<12;x++){
            data.setValue(x, 0, ''+(x+1));
            data.setValue(x, 1, 0);
            data.setValue(x, 2, 0);
        }
    	
		dataSources[0] = data;
		
    }
    
    /*
     * Create default chart and data values
     * @return void
     */
    function initialiseForm(){
    
        $("#button-example-form").change(onButtonClick);
        initialiseData();
        chart.initialise();
    }
    
    </script>
    <!-- end of chart -->
    
    <!-- start of metabolic code -->
    <script type="text/javascript" src="../yui/build/yuiloader/yuiloader.js"></script>
    	<script type="text/javascript">
		var loader = new YAHOO.util.YUILoader();
		/*loader.insert({
		    require: ['fonts','dragdrop','logger'],
		    base: '../yui/build/',
		
		    onSuccess: function(loader) {
		            YAHOO.util.Event.addListener(YAHOO.util.Dom.get("loglink"), "click", function(e) {
		                YAHOO.util.Event.stopEvent(e);
		                YAHOO.log("This is a simple log message.");
		            });
		
		            // Put a LogReader on your page
		            this.myLogReader = new YAHOO.widget.LogReader();
		    }
		});*/
		
		
		/*
		 * Create a metabolism object
		 */ 
		var metabolism = new Metabolism();
		//YAHOO.log("metabolism.initialise() =  " + metabolism.initialise(), "info", "example1");
		
		function displayCalorieDifference(difference){
			element = document.getElementById("calorie-difference");
			element.value = difference;

			kilos = customRound(difference/9000, 2);
			element = document.getElementById("calorie-difference-kgs");
			element.value = kilos;

			stone = customRound(kilos/6.35, 2);
			element = document.getElementById("calorie-difference-stone");
			element.value = stone;
		}

		 // "click" event handler for each Button instance

		function onButtonClick(p_oEvent) {

			var weight = getElementValue("weight");
			var percentFat = getElementValue("percent-fat");

			var caloriesIn = getElementValue("calories-in");


			var lbm = metabolism.calculateLeanBodyMass(weight, percentFat);
			var bmr = metabolism.calculateMetabolicRate(lbm);
			var tef = metabolism.calculateThermicEffectOfFood(caloriesIn);
			
			var days = getElementValue("days");
			
			var weightStone = customRound(converter(weight, 1), 2);


			// Exercise
			var exerciseDuration = getElementValue("exercise-duration");
			var intensity = getElementValue("exercise-intensity");
			var speed = getSpeedFromIntensity(intensity);

			// Speed is in mph we need kph
			speed = calculateKilometresFromMiles(speed);

			// How many calories are burnt per minute?
			var exerciseCalories = metabolism.calculateExerciseEnergyExpenditure(weight, speed);

			// How many for the exercise duration?
			exerciseCalories = exerciseCalories*exerciseDuration;

			// so how many calories are burnt in total?
			caloriesOut = (bmr+tef+exerciseCalories);

			var difference = metabolism.calculateCalorieDifference(caloriesIn, caloriesOut);
			//displayCalorieDifference(difference);
			kilos = difference/9000;
			stones = converter(kilos, 1);

            // save difference for chart.
            var dailyDifference = difference;
            var dailyKilos = kilos;

			// Update the display
			updateDisplay([
							new DisplayNumericItem("weight-stone", weightStone),
							new DisplayNumericItem("lbm", lbm),
							new DisplayNumericItem("bmr", bmr),
							new DisplayNumericItem("tef", tef),
							new DisplayNumericItem("exercise-calories", exerciseCalories),
							new DisplayNumericItem("calories-out", caloriesOut),
							new DisplayNumericItem("calorie-difference", difference),
							new DisplayNumericItem("calorie-difference-kgs", kilos),
							new DisplayNumericItem("calorie-difference-stone", stones)
						]);
			// Now work out the values for 	
						// Multiply calories in by the number of days
			caloriesIn = caloriesIn*days;
			caloriesOut = caloriesOut*days;
			difference = difference*days;
			kilos = kilos*days;
			stones = stones*days;
			
			// Update the display
			updateDisplay([
							new DisplayNumericItem("days-calories-in", caloriesIn),
							new DisplayNumericItem("days-calories-out", caloriesOut),
							new DisplayNumericItem("days-calorie-difference", difference),
							new DisplayNumericItem("days-calorie-difference-kgs", kilos),
							new DisplayNumericItem("days-calorie-difference-stone", stones)
			]);
                        
        
            var daysInMonth = 30;
            var months = 12;
            var cumulativeDifference = 0;
            var cumulativeKilos = 0;
            var monthDifference = dailyDifference*daysInMonth;
            var monthlyKilos = dailyKilos*daysInMonth;
            alert('dailyKilos = '+dailyKilos);
            for(var x=0;x<months;x++){
                cumulativeDifference+=monthDifference;
                cumulativeKilos+=monthlyKilos;
                data.setValue(x, 0, ''+(x+1));
                data.setValue(x, 1, cumulativeDifference);
                data.setValue(x, 2, cumulativeKilos);
            }
            
            chart.draw();
              
    	}

// "contentready" event handler for the "pushbuttonsfrommarkup" <fieldset>

		YAHOO.util.Event.onContentReady("pushbuttons", function () {

				// Create Buttons using existing <input> elements as a data source

				var oPushButton3 = new YAHOO.widget.Button("pushbutton", { onclick: { fn: onButtonClick } });

});


		</script>
        <!-- end of metabolic code -->


  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix('img, .png_bg'); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->


  <!-- mathiasbynens.be/notes/async-analytics-snippet Change UA-XXXXX-X to be your site's ID -->
  <script>
    var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>

</body>
</html>