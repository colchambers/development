<html>
  <head>
    
  <style type="text/css">
  

    table th input, .table-column-label * {
      font-weight: bold;
    }
    
    .help-link {
      text-decoration: underline;
    }
  </style>
  
  </head>

  <body>
  <div id="chart_div"></div>
  <div id="form_div"></div>
  
  
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.min.js"></script> 
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script> 
  <script type="text/javascript" src="http://github.com/malsup/form/raw/master/jquery.form.js?v2.43"></script> 
  
  <script type="text/javascript" src="scripts/display/display.js"></script>
  <script type="text/javascript" src="scripts/lib.js"></script>
  <script type="text/javascript" src="js/chart.js"></script>
  <script type="text/javascript" src="js/form.js"></script>
  <script type="text/javascript" src="js/io.js"></script>
 
    <script type="text/javascript"> 
  
        //alert('setup form');
        // wait for the DOM to be loaded 
        $(document).ready(function() { 
            // bind 'myForm' and provide a simple callback function 
           $('#form-1').ajaxForm(function() {
        alert('Handler for .submit() called.');
        updateDataSourceFromForm();
        return false;
      });
        }); 
    
    var chartTypes = [];
    
    function VisualisationType (type, title, method){
    
    this.type = type;
    this.title = title;
    this.method = method
    }
    chartTypes[0] = new VisualisationType('columnchart', 'Column chart', 'ColumnChart')

    
    
	var definedVariables = [];
	
	// define and document relationships between variables. 
	definedVariables['dataUrl'] = new DefinedVariable('dataUrl', 'defaultDataUrl', 'du');
	definedVariables['dataStatement'] = new DefinedVariable('dataStatement', 'defaultDataStatement', 'ds');
	definedVariables['chartTitle'] = new DefinedVariable('chartTitle', 'defaultChartTitle', 'ct');
	definedVariables['chartHeight'] = new DefinedVariable('chartHeight', 'defaultChartHeight', 'ch');
	definedVariables['chartWidth'] = new DefinedVariable('chartWidth', 'defaultChartWidth', 'cw');
	definedVariables['visualisationType'] = new DefinedVariable('visualisationType', 'visualisationType', 'vt');
    
    
    for(var x=0;x<chartTypes.length;x++){
		google.load("visualization", "1", {packages:[chartTypes[x].type]});
    }


    google.setOnLoadCallback(initialiseForm);
    //google.setOnLoadCallback(sendAndDraw);
    
    var data = null;
    var chart = null;
    var chartOptions = null;
    var visualisationType = 0;
    var chartElementId = 'chart_div';
    var dataSources = [];
    var currentDataSourceId = 0;
    var defaultChartWidth = 400;
    var defaultChartHeight = 240;
	var defaultChartTitle = 'Default Title';
    var defaultChartIs3D = true;
    var numberOfRowsInForm = 10;
    var queryUrls = [];
    var queryString = '';
	var queryStringValues = [];
	
    /*
     * Create default chart and data values
     * @return void
     */
    function initialiseData(){
    
		// UK fat intake 1970-2000
		chartOptions = createDefaultChartOptions();
		chartOptions.title = defaultChartTitle;
		dataSource = null;
	   
		data = new google.visualization.DataTable(dataSource);
		//data.url = defaultDataUrl; 
		//data.statement = defaultDataStatement;
		//data.query = new google.visualization.Query(data.url);
		//data.query.setQuery(data.statement);
		data.chartOptions = chartOptions;
			data.source = 'Mean total fat intake in the UK per person per day, together with the percentage ';
		data.source += 'of total energy in the fiet obtained form the different types of fatty acis, 1970 - 2000';
		data.source += '(SK183) Understanding human nutrition. P72';
		data.title = 'UK fat intake 1970-2000';
        
        data.addColumn('string', 'Year');
        data.addColumn('number', 'Sales');
        data.addColumn('number', 'Expenses');
        data.addRows(4);
        data.setValue(0, 0, '2004');
        data.setValue(0, 1, 1000);
        data.setValue(0, 2, 400);
    	
        data.setValue(1, 0, '2005');
        data.setValue(1, 1, 1170);
        data.setValue(1, 2, 460);
		
        data.setValue(2, 0, '2006');
        data.setValue(2, 1, 660);
        data.setValue(2, 2, 1120);
		
        data.setValue(3, 0, '2007');
        data.setValue(3, 1, 1030);
        data.setValue(3, 2, 540);
		
		dataSources[0] = data;
		
		// set default data source
		data = dataSources[currentDataSourceId];
    
    
    }
    
    /*
     * Create default chart and data values
     * @return void
     */
    function initialiseForm(){
    
        initialiseData();
        initialiseChart();
       
        //updateVisualization(typeId);
        // add an element to the form div
        var formHtml = '';
        formHtml += '<form id="form-1">';
        formHtml += '  <input type="submit" id="submit-1" />';
        formHtml += '</form>';
        $("#form_div").append(formHtml);
        alert('initialiseForm');
        // append functionality to form objects
        // bind 'myForm' and provide a simple callback function 
               $('#form-1').ajaxForm(function() {
            alert('Handler for .submit() called.');
            updateDataSourceFromForm();
            return false;
          });
        
        //$("#chart-type").change(formChangeHandler);
        //$("#data-source").change(formChangeHandler);
        
        updateForm();
        alert('after update form.');
    }
    
    function formChangeHandler(){
        alert('Handler for .submit() formchangehandler called.');
        updateDataSourceFromForm();
        return false;
    }
    
    /*
     * Update the form using the chart and data values
     * @return void
     */
    function updateForm(){
        //chartOptions = data.chartOptions;
		//$("#chart-title").val(chartOptions.title);
		//$("#chart-height").val(chartOptions.height);
		//$("#chart-width").val(chartOptions.width);
		//$("#chart-source").val(data.source);
    }
    
    /*
     * Update the chart and data values using the form 
     * @return void
     */
    function updateDataSourceFromForm(){
        alert('12');
        data.setValue(3, 1, 10030);
        data.setValue(3, 2, 5040);
        updateVisualization(2);
          
    }

    </script>
  </body>
</html>